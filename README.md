
AI の出力した下記設計をもとに、AIを使わずに実装・学習を行い自走する力をつける

# Phase 1 設計仕様書 — StudyLog（学習記録アプリ）

> **使い方**
> 1. 各画面の設計を読み、自分の言葉で「実装メモ」を作成する
> 2. 実装メモをリードにレビューしてもらう
> 3. 実装 → 差分整理 → レビュー依頼

---
## 実装想定デザイン
[studylog-design-preview.html](https://github.com/t-ishiguro0025/MBO-2025-early/blob/develop/studylog-design-preview.html) がデザイン

- ログイン画面
<img width="843" height="676" alt="スクリーンショット 2026-02-24 21 15 01" src="https://github.com/user-attachments/assets/9fc33a0a-4db1-42ba-94b4-f1275167694e" />

- 一覧画面
<img width="843" height="676" alt="スクリーンショット 2026-02-24 21 15 04" src="https://github.com/user-attachments/assets/49ffb04c-3e9b-4311-a507-37f307a2a081" />

- 詳細画面
<img width="843" height="676" alt="スクリーンショット 2026-02-24 21 15 07" src="https://github.com/user-attachments/assets/b38621ca-5ef4-4983-802d-e28d0230576c" />

- 空/エラー画面
<img width="382" height="476" alt="スクリーンショット 2026-02-24 21 16 29" src="https://github.com/user-attachments/assets/f76e7605-e7b3-49c0-a30e-57b8335cd8d3" />



## 共通前提

| 項目 | 内容 |
|------|------|
| フレームワーク | React (Vite) |
| UI ライブラリ | Mantine v7 または shadcn/ui |
| バリデーション | zod |
| API | MSW（Mock Service Worker）によるモック |
| ルーティング | React Router v6 |
| 状態管理 | useState / useReducer |

## AI にやってもらうこと
- 設計
- デザイン作成
- テストファイル作成

## （実装）調査方法
AIは使わず公式ドキュメントを確認する

### 想定アプリ概要

**「StudyLog」— 学習記録アプリ**

自分の学習時間・科目・メモを記録・振り返るための個人向け Web アプリ。
ログイン後に学習ログの一覧を閲覧・検索でき、各ログの詳細を確認できる。

**主なデータモデル：StudyLog（学習記録）**

| フィールド | 型 | 説明 |
|-----------|-----|------|
| `id` | `string` | 一意識別子 |
| `subject` | `string` | 科目名（例：React、英語） |
| `duration` | `number` | 学習時間（分） |
| `memo` | `string` | 学習内容のメモ |
| `studiedAt` | `string` | 学習した日時（ISO 8601） |
| `createdAt` | `string` | 記録作成日時 |

---

## 画面① ログイン画面

### 画面の目的
ユーザーが認証情報（メールアドレス・パスワード）を入力し、自分の学習記録にアクセスする。

### 想定ユースケース
- UC-01：正しい認証情報でログインし、一覧画面へ遷移する
- UC-02：間違ったパスワードでログインし、エラーメッセージを確認する
- UC-03：未入力のままログインボタンを押し、バリデーションエラーを確認する
- UC-04：ログイン済みの場合、ログイン画面にアクセスしても一覧画面にリダイレクトされる

### 状態（UI / データ）

| 状態名 | 型 | 初期値 | 説明 |
|--------|-----|--------|------|
| `email` | `string` | `""` | メールアドレス入力値 |
| `password` | `string` | `""` | パスワード入力値 |
| `isLoading` | `boolean` | `false` | ログイン API 呼び出し中フラグ |
| `apiError` | `string \| null` | `null` | サーバーから返ったエラーメッセージ |
| `fieldErrors` | `Record<string, string>` | `{}` | フィールド単位のバリデーションエラー |

**UI 状態の遷移**
```
初期状態
  → [入力中] fieldErrors が都度更新
  → [ログインボタン押下] isLoading = true
      → [成功] /logs にリダイレクト
      → [失敗] isLoading = false, apiError にエラー文言をセット
```

### API 想定

```
POST /api/auth/login
Request:  { email: string, password: string }
Response:
  200: { token: string, user: { id: string, name: string, email: string } }
  401: { message: "メールアドレスまたはパスワードが正しくありません" }
```

**モックデータ**
- `email: study@example.com` / `password: password123` → 200
- それ以外 → 401

### バリデーション仕様

| フィールド | ルール |
|-----------|--------|
| email | 必須 / メールアドレス形式 |
| password | 必須 / 8文字以上 |

### コンポーネント構成案

```
LoginPage
└── LoginForm                   # フォームの状態管理・送信処理
    ├── EmailField               # メールアドレス入力 + エラー表示
    ├── PasswordField            # パスワード入力（表示/非表示切り替えボタン付き）+ エラー表示
    ├── ApiErrorAlert            # サーバーエラーのアラート（apiError があるときだけ表示）
    └── SubmitButton             # isLoading 時は disabled + スピナー表示
```

### 設計上の判断ポイント（理解確認用）

- **なぜ `apiError` と `fieldErrors` を分けるのか？**
  → バリデーションエラーは各フィールドに紐づけて表示する。サーバーエラーは画面全体への通知として表示する。役割が違うので別管理。
- **なぜ送信前にフロントでバリデーションするのか？**
  → 不要な API 通信を減らしてユーザー体験を向上させるため。ただしサーバー側のバリデーションは必ず必要（フロントは信頼できない）。
- **`isLoading` 中にボタンを disabled にする理由**
  → 連続クリックによる二重送信を防ぐため。

---

## 画面② 学習ログ一覧画面（検索・フィルタ・ページング）

### 画面の目的
自分が記録した学習ログを一覧で確認・検索・絞り込みできる。詳細画面や記録作成画面へのエントリーポイントとなる中心的な画面。

### 想定ユースケース
- UC-01：一覧画面を開くと、最新の学習ログが表示される（新しい順）
- UC-02：科目名でログを検索する（部分一致）
- UC-03：科目カテゴリでログを絞り込む
- UC-04：ページングでデータを切り替える
- UC-05：ログをクリックして詳細画面に遷移する
- UC-06：ログが1件もない場合は空状態コンポーネントを表示する
- UC-07：API エラー時にエラー状態コンポーネントを表示する

### 状態（UI / データ）

| 状態名 | 型 | 初期値 | 説明 |
|--------|-----|--------|------|
| `logs` | `StudyLog[]` | `[]` | API から取得した学習ログ一覧 |
| `total` | `number` | `0` | 全件数（ページング計算に使用） |
| `isLoading` | `boolean` | `true` | データ取得中フラグ |
| `error` | `string \| null` | `null` | API エラーメッセージ |
| `searchQuery` | `string` | `""` | 検索キーワード（科目名） |
| `subjectFilter` | `string` | `"all"` | 科目カテゴリ絞り込み |
| `currentPage` | `number` | `1` | 現在のページ番号 |
| `pageSize` | `number` | `10` | 1ページあたりの件数 |

**重要な設計判断：検索・フィルタのタイミング**
- 検索は debounce（300ms）を使い、入力が止まってから API 呼び出し
- フィルタ変更・ページ変更は即時 API 呼び出し
- 検索・フィルタが変わったら `currentPage` を 1 にリセットする

### API 想定

```
GET /api/logs
Query Params:
  - q: string（キーワード検索、省略可）
  - subject: string（科目フィルタ、省略時は全件）
  - page: number（1始まり）
  - limit: number（デフォルト10）

Response 200:
{
  logs: StudyLog[],
  total: number,
  page: number,
  limit: number
}
```

**モックデータ例**

| subject | duration | memo | studiedAt |
|---------|----------|------|-----------|
| React | 90 | コンポーネント設計を学んだ | 2025-06-10 |
| 英語 | 30 | 単語帳アプリで50問 | 2025-06-09 |
| アルゴリズム | 60 | 二分探索を実装した | 2025-06-08 |
| React | 45 | useEffect の挙動確認 | 2025-06-07 |

### コンポーネント構成案

```
StudyLogListPage
├── PageHeader                      # 画面タイトル + (将来) 記録追加ボタン
├── LogFilterBar                    # 検索・フィルタ UI
│   ├── SearchInput                 # debounce 付き科目名検索
│   └── SubjectFilterSelect         # 科目カテゴリ絞り込みセレクト
├── LogListContent                  # isLoading / error / empty / データ の出し分け
│   ├── [isLoading] LogListSkeleton # スケルトンローディング
│   ├── [error]     ErrorState      # ④ を流用
│   ├── [empty]     EmptyState      # ④ を流用
│   └── [data]      LogCardList     # 学習ログのカード一覧
│       └── LogCard
│           ├── SubjectLabel        # 科目名
│           ├── DurationBadge       # 学習時間（○○分 / ○時間○分）
│           ├── StudiedAtLabel      # 学習日
│           └── MemoPreview         # メモの冒頭数十文字
└── Pagination
```

### カスタムフック設計

データ取得ロジックはカスタムフック（`useStudyLogs`）に分離する。
検索・フィルタ・ページのパラメータを受け取り、`{ logs, total, isLoading, error, refetch }` を返す。

**なぜカスタムフックに分離するのか？**
→ ページコンポーネントから「データ取得の責務」を切り離す。コンポーネントは UI の表示に専念でき、テストもしやすくなる。

### 設計上の判断ポイント（理解確認用）

- **debounce を使う理由**：入力のたびに API を叩くと過剰なリクエストが発生するため
- **スケルトン vs スピナー**：一覧はレイアウトが既知なのでスケルトンの方が体感速度が速い
- **フィルタ変更時にページをリセットする理由**：2ページ目で絞り込んだとき結果が空になる可能性を防ぐ
- **`total` を API から返す理由**：フロントで全件取得してスライスするのはパフォーマンス的に NG

---

## 画面③ 学習ログ詳細画面

### 画面の目的
特定の学習ログの詳細情報を表示する。一覧画面のカードをクリックして遷移してくる読み取り専用の画面。

### 想定ユースケース
- UC-01：URL（`/logs/:id`）に直接アクセスして詳細を表示する
- UC-02：存在しない ID にアクセスして 404 状態を表示する
- UC-03：API エラー時にエラー状態を表示する
- UC-04：戻るボタンで一覧画面に戻る

### 状態（UI / データ）

| 状態名 | 型 | 初期値 | 説明 |
|--------|-----|--------|------|
| `log` | `StudyLog \| null` | `null` | 取得した学習ログデータ |
| `isLoading` | `boolean` | `true` | データ取得中フラグ |
| `error` | `{ type: "not_found" \| "server_error"; message: string } \| null` | `null` | エラー種別 |

**エラーを `type` で分ける設計理由**：404（存在しない）と 500（取得失敗）では表示するメッセージと次のアクションが異なるため。

### API 想定

```
GET /api/logs/:id
Response:
  200: StudyLog
  404: { message: "学習ログが見つかりません" }
  500: { message: "サーバーエラーが発生しました" }
```

### コンポーネント構成案

```
StudyLogDetailPage
├── PageHeader
│   ├── BackButton                  # /logs へ戻る
│   └── (将来) EditButton
└── LogDetailContent                # isLoading / error / データ の出し分け
    ├── [isLoading] DetailSkeleton
    ├── [error: not_found]   NotFoundState
    ├── [error: server_error] ErrorState
    └── [data] LogDetailCard
        ├── SubjectHeading          # 科目名（h1 相当）
        ├── DurationBadge           # 学習時間
        ├── StudiedAtLabel          # 学習日時
        └── MemoSection             # メモ全文
```

### 設計上の判断ポイント（理解確認用）

- **`id` はどこから取得するか**：URL パラメータから取得する
- **`DurationBadge` を一覧と共通化する理由**：同じ表示ロジックを 2 箇所に書くと、仕様変更時に漏れが生じる（DRY 原則）
- **データ取得のタイミング**：URL の id が変わるたびに再フェッチする

---

## 画面④ エラー / 空状態コンポーネント

### 画面の目的
データが存在しない・API エラーが発生した場合に、ユーザーに分かりやすくフィードバックし、次のアクションを促す。

> この画面は「独立した画面」ではなく、一覧・詳細などの中に組み込まれる **共通コンポーネント** として設計する。

### 想定ユースケース
- UC-01：一覧で検索結果が 0 件（空状態）
- UC-02：一覧で API エラーが発生
- UC-03：詳細で 404 エラーが発生
- UC-04：詳細でサーバーエラーが発生
- UC-05：各状態から「再試行」または「一覧に戻る」アクションを行う

### コンポーネントが受け取る情報

**EmptyState（空状態）**

| props | 説明 |
|-------|------|
| `title` | メインメッセージ |
| `description` | サブメッセージ（任意） |
| `action` | ボタンのラベルとクリック処理（任意） |
| `icon` | アイコン（任意） |

**ErrorState（エラー状態）**

| props | 説明 |
|-------|------|
| `type` | `"not_found"` / `"server_error"` / `"network_error"` |
| `title` | メインメッセージ（任意・デフォルト文言あり） |
| `description` | サブメッセージ（任意） |
| `action` | ボタンのラベルとクリック処理（任意） |

### 各状態の表示内容定義

| 状態 | タイトル | 説明 | アクション |
|------|----------|------|-----------|
| 検索結果なし | 「ログが見つかりません」 | 「別のキーワードや科目でお試しください」 | 「条件をクリア」 |
| 初回（記録なし） | 「まだ学習ログがありません」 | 「最初の学習を記録してみましょう」 | 「ログを追加」（将来） |
| API エラー | 「データを取得できませんでした」 | 「しばらく待ってから再試行してください」 | 「再試行」（refetch） |
| 404 | 「ログが見つかりません」 | 「URLが正しいか確認してください」 | 「一覧に戻る」 |

### コンポーネント構成案

```
EmptyState
├── StateIcon           # 状態に応じたアイコン or イラスト
├── StateTitle          # メインメッセージ
├── StateDescription    # サブメッセージ
└── ActionButton        # action が渡されたときだけ表示

ErrorState
├── ErrorIcon
├── ErrorTitle
├── ErrorDescription
└── ActionButton
```

### 設計上の判断ポイント（理解確認用）

- **なぜ props で `title` / `description` / `action` を受け取るのか？**
  → 同じ UI パターンを多くの場面で使い回すため（汎用コンポーネント化）。呼び出す側が文言とアクションを決める。
- **空状態とエラー状態を別コンポーネントに分ける理由**
  → 意味が異なる（「データなし」vs「処理失敗」）。将来のスタイル変更の影響範囲を限定できる。
- **「初回ログなし」と「検索結果なし」の空状態を出し分ける理由**
  → ユーザーへの促し方が違う。初回は「追加してみよう」、検索結果なしは「条件を変えてみよう」。

---

## スキーマ設計

### loginSchema（Week 1）

**目的**：ログインフォームの入力値が正しいかチェックするルールを定義する。

**対象ファイル**：`features/auth/schemas/loginSchema.ts`

| フィールド | チェック内容 | エラーメッセージ |
|-----------|------------|----------------|
| `email` | 必須 | メールアドレスを入力してください |
| `email` | メールアドレス形式 | 正しいメールアドレスを入力してください |
| `password` | 必須 | パスワードを入力してください |
| `password` | 8文字以上 | パスワードは8文字以上で入力してください |

**スキーマから生成する型**：`LoginInput`（フォームの入力値の型として使い回す）

**設計上の判断ポイント**
- **なぜスキーマから型を生成するのか？**
  → バリデーションルールと型定義を一箇所で管理するため。ルールを変えたとき型も自動で追従する。
- **なぜ `required` チェックと `format` チェックを分けて定義するのか？**
  → エラーメッセージをケースごとに出し分けるため。「未入力」と「形式違い」は別のメッセージを表示したい。

---

## Phase 1 実装順（推奨）

```
Week 1: ① ログイン画面
         → zod / フォーム / API 通信 / エラーハンドリングの基礎を掴む

Week 2: ④ エラー / 空状態コンポーネント（先に作る）
         → 一覧・詳細で使い回すため先行実装しておく

Week 3: ② 学習ログ一覧画面
         → データ取得 / カスタムフック / debounce / ページング

Week 4: ③ 学習ログ詳細画面
         → useParams / エラー種別の出し分け / 共通コンポーネントの活用
```

---

## 共通コンポーネント整理（実装が進んだら更新）

| コンポーネント名 | 役割 | 使用画面 |
|-----------------|------|---------|
| `DurationBadge` | 学習時間の表示（○○分 / ○時間○分） | 一覧・詳細 |
| `SubjectLabel` | 科目名のラベル | 一覧・詳細 |
| `EmptyState` | データなし状態の表示 | 一覧 |
| `ErrorState` | エラー状態の表示 | 一覧・詳細 |
| `PageHeader` | ページタイトル + 戻るボタン | 詳細 |

---

## 実装メモ作成テンプレート

各画面の実装前に、以下を自分の言葉で埋めてから実装を始めてください。

```markdown
# 実装メモ：[画面名]

## 1. 設計の理解（自分の言葉で）
- この画面の目的は何か
- どんなユーザー操作を想定しているか
- 状態は何があり、それぞれいつ変化するか

## 2. 実装対象と実装順
1. まず ○○ を実装する（理由：）
2. 次に ○○ を実装する（理由：）

## 3. 使用する技術・ライブラリ
- フォーム管理：
- バリデーション：
- API 通信：
- 状態管理：

## 4. 不明点・懸念点
- [ ] ○○ の動作が不明
- [ ] ○○ の実装方法がわからない

## 5. 実装後の振り返り
- 設計との差分（あれば）
- 実装判断の理由
- 次回への改善点
```
