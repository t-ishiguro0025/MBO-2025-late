{"version":3,"file":"getMetaTagTransformer.js","sources":["../../../src/server/getMetaTagTransformer.ts"],"sourcesContent":["import type { PassThrough } from 'node:stream';\nimport { Transform } from 'node:stream';\nimport { getTraceMetaTags } from '@sentry/core';\n\n/**\n * Injects Sentry trace meta tags into the HTML response by piping through a transform stream.\n * This enables distributed tracing by adding trace context to the HTML document head.\n *\n * @param body - PassThrough stream containing the HTML response body to modify\n */\nexport function getMetaTagTransformer(body: PassThrough): Transform {\n  const headClosingTag = '</head>';\n  const htmlMetaTagTransformer = new Transform({\n    transform(chunk, _encoding, callback) {\n      const html = Buffer.isBuffer(chunk) ? chunk.toString() : String(chunk);\n      if (html.includes(headClosingTag)) {\n        const modifiedHtml = html.replace(headClosingTag, `${getTraceMetaTags()}${headClosingTag}`);\n        callback(null, modifiedHtml);\n        return;\n      }\n      callback(null, chunk);\n    },\n  });\n  htmlMetaTagTransformer.pipe(body);\n  return htmlMetaTagTransformer;\n}\n"],"names":["Transform","getTraceMetaTags"],"mappings":";;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,qBAAqB,CAAC,IAAI,EAA0B;AACpE,EAAE,MAAM,cAAA,GAAiB,SAAS;AAClC,EAAE,MAAM,sBAAA,GAAyB,IAAIA,qBAAS,CAAC;AAC/C,IAAI,SAAS,CAAC,KAAK,EAAE,SAAS,EAAE,QAAQ,EAAE;AAC1C,MAAM,MAAM,IAAA,GAAO,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAA,GAAI,KAAK,CAAC,QAAQ,EAAC,GAAI,MAAM,CAAC,KAAK,CAAC;AAC5E,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE;AACzC,QAAQ,MAAM,YAAA,GAAe,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE,CAAC,EAAAC,qBAAA,EAAA,CAAA,EAAA,cAAA,CAAA,CAAA,CAAA;AACA,QAAA,QAAA,CAAA,IAAA,EAAA,YAAA,CAAA;AACA,QAAA;AACA,MAAA;AACA,MAAA,QAAA,CAAA,IAAA,EAAA,KAAA,CAAA;AACA,IAAA,CAAA;AACA,GAAA,CAAA;AACA,EAAA,sBAAA,CAAA,IAAA,CAAA,IAAA,CAAA;AACA,EAAA,OAAA,sBAAA;AACA;;;;"}