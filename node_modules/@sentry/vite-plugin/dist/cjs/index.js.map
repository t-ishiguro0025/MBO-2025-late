{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import {\n  CodeInjection,\n  sentryUnpluginFactory,\n  Options,\n  createRollupInjectionHooks,\n  createRollupDebugIdUploadHooks,\n  SentrySDKBuildFlags,\n  createRollupBundleSizeOptimizationHooks,\n  createComponentNameAnnotateHooks,\n  Logger,\n} from \"@sentry/bundler-plugin-core\";\nimport { createRequire } from \"node:module\";\nimport { UnpluginOptions, VitePlugin } from \"unplugin\";\n\nfunction viteInjectionPlugin(injectionCode: CodeInjection, debugIds: boolean): UnpluginOptions {\n  return {\n    name: \"sentry-vite-injection-plugin\",\n    // run `post` to avoid tripping up @rollup/plugin-commonjs when cjs is used\n    // as we inject an `import` statement\n    enforce: \"post\" as const, // need this so that vite runs the resolveId hook\n    vite: createRollupInjectionHooks(injectionCode, debugIds),\n  };\n}\n\nfunction viteComponentNameAnnotatePlugin(\n  ignoredComponents: string[],\n  injectIntoHtml: boolean\n): UnpluginOptions {\n  return {\n    name: \"sentry-vite-component-name-annotate-plugin\",\n    enforce: \"pre\" as const,\n    vite: createComponentNameAnnotateHooks(ignoredComponents, injectIntoHtml),\n  };\n}\n\nfunction viteDebugIdUploadPlugin(\n  upload: (buildArtifacts: string[]) => Promise<void>,\n  logger: Logger,\n  createDependencyOnBuildArtifacts: () => () => void\n): UnpluginOptions {\n  return {\n    name: \"sentry-vite-debug-id-upload-plugin\",\n    vite: createRollupDebugIdUploadHooks(upload, logger, createDependencyOnBuildArtifacts),\n  };\n}\n\nfunction viteBundleSizeOptimizationsPlugin(\n  replacementValues: SentrySDKBuildFlags\n): UnpluginOptions {\n  return {\n    name: \"sentry-vite-bundle-size-optimizations-plugin\",\n    vite: createRollupBundleSizeOptimizationHooks(replacementValues),\n  };\n}\n\nfunction getViteMajorVersion(): string | undefined {\n  try {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore - Rollup already transpiles this for us\n    const req = createRequire(import.meta.url);\n    const vite = req(\"vite\") as { version?: string };\n    return vite.version?.split(\".\")[0];\n  } catch (err) {\n    // do nothing, we'll just not report a version\n  }\n\n  return undefined;\n}\n\nconst sentryUnplugin = sentryUnpluginFactory({\n  injectionPlugin: viteInjectionPlugin,\n  componentNameAnnotatePlugin: viteComponentNameAnnotatePlugin,\n  debugIdUploadPlugin: viteDebugIdUploadPlugin,\n  bundleSizeOptimizationsPlugin: viteBundleSizeOptimizationsPlugin,\n  getBundlerMajorVersion: getViteMajorVersion,\n});\n\nexport const sentryVitePlugin = (options?: Options): VitePlugin[] => {\n  const result = sentryUnplugin.vite(options);\n  // unplugin returns a single plugin instead of an array when only one plugin is created, so we normalize this here.\n  return Array.isArray(result) ? result : [result];\n};\n\nexport type { Options as SentryVitePluginOptions } from \"@sentry/bundler-plugin-core\";\nexport { sentryCliBinaryExists } from \"@sentry/bundler-plugin-core\";\n"],"names":["viteInjectionPlugin","injectionCode","debugIds","name","enforce","vite","createRollupInjectionHooks","viteComponentNameAnnotatePlugin","ignoredComponents","injectIntoHtml","createComponentNameAnnotateHooks","viteDebugIdUploadPlugin","upload","logger","createDependencyOnBuildArtifacts","createRollupDebugIdUploadHooks","viteBundleSizeOptimizationsPlugin","replacementValues","createRollupBundleSizeOptimizationHooks","getViteMajorVersion","_vite$version","req","createRequire","import","version","split","err","undefined","sentryUnplugin","sentryUnpluginFactory","injectionPlugin","componentNameAnnotatePlugin","debugIdUploadPlugin","bundleSizeOptimizationsPlugin","getBundlerMajorVersion","sentryVitePlugin","options","result","Array","isArray"],"mappings":";;;;;;;AAcA,SAASA,mBAAmBA,CAACC,aAA4B,EAAEC,QAAiB,EAAmB;EAC7F,OAAO;AACLC,IAAAA,IAAI,EAAE,8BAA8B;AACpC;AACA;AACAC,IAAAA,OAAO,EAAE,MAAe;AAAE;AAC1BC,IAAAA,IAAI,EAAEC,4CAA0B,CAACL,aAAa,EAAEC,QAAQ,CAAA;GACzD,CAAA;AACH,CAAA;AAEA,SAASK,+BAA+BA,CACtCC,iBAA2B,EAC3BC,cAAuB,EACN;EACjB,OAAO;AACLN,IAAAA,IAAI,EAAE,4CAA4C;AAClDC,IAAAA,OAAO,EAAE,KAAc;AACvBC,IAAAA,IAAI,EAAEK,kDAAgC,CAACF,iBAAiB,EAAEC,cAAc,CAAA;GACzE,CAAA;AACH,CAAA;AAEA,SAASE,uBAAuBA,CAC9BC,MAAmD,EACnDC,MAAc,EACdC,gCAAkD,EACjC;EACjB,OAAO;AACLX,IAAAA,IAAI,EAAE,oCAAoC;AAC1CE,IAAAA,IAAI,EAAEU,gDAA8B,CAACH,MAAM,EAAEC,MAAM,EAAEC,gCAAgC,CAAA;GACtF,CAAA;AACH,CAAA;AAEA,SAASE,iCAAiCA,CACxCC,iBAAsC,EACrB;EACjB,OAAO;AACLd,IAAAA,IAAI,EAAE,8CAA8C;IACpDE,IAAI,EAAEa,yDAAuC,CAACD,iBAAiB,CAAA;GAChE,CAAA;AACH,CAAA;AAEA,SAASE,mBAAmBA,GAAuB;EACjD,IAAI;AAAA,IAAA,IAAAC,aAAA,CAAA;AACF;AACA;IACA,IAAMC,GAAG,GAAGC,yBAAa,CAACC,mMAAe,CAAC,CAAA;AAC1C,IAAA,IAAMlB,IAAI,GAAGgB,GAAG,CAAC,MAAM,CAAyB,CAAA;AAChD,IAAA,OAAA,CAAAD,aAAA,GAAOf,IAAI,CAACmB,OAAO,cAAAJ,aAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAZA,aAAA,CAAcK,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;GACnC,CAAC,OAAOC,GAAG,EAAE;AACZ;AAAA,GAAA;AAGF,EAAA,OAAOC,SAAS,CAAA;AAClB,CAAA;AAEA,IAAMC,cAAc,GAAGC,uCAAqB,CAAC;AAC3CC,EAAAA,eAAe,EAAE9B,mBAAmB;AACpC+B,EAAAA,2BAA2B,EAAExB,+BAA+B;AAC5DyB,EAAAA,mBAAmB,EAAErB,uBAAuB;AAC5CsB,EAAAA,6BAA6B,EAAEjB,iCAAiC;AAChEkB,EAAAA,sBAAsB,EAAEf,mBAAAA;AAC1B,CAAC,CAAC,CAAA;IAEWgB,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAIC,OAAiB,EAAmB;AACnE,EAAA,IAAMC,MAAM,GAAGT,cAAc,CAACvB,IAAI,CAAC+B,OAAO,CAAC,CAAA;AAC3C;EACA,OAAOE,KAAK,CAACC,OAAO,CAACF,MAAM,CAAC,GAAGA,MAAM,GAAG,CAACA,MAAM,CAAC,CAAA;AAClD;;;;;;;;"}